# ABUILD generated by mkpkg_generator.sh

pkgname=bash
pkgver=4.1
pkgbuild=1
arch=('auto')

shortdesc=('bash (sh-compatible shell)')
longdesc=('The GNU Bourne-Again SHell. Bash is a sh-compatible command interpreter that executes commands read from the standard input or from a file. Bash also incorporates useful features from the Korn and C shells (ksh and csh). Bash is ultimately intended to be a conformant implementation of the IEEE Posix Shell and Tools specification (IEEE Working Group 1003.2). Bash must be present for the system to boot properly.')

tags=("app-shells base")
source=("http://ftp.gnu.org/gnu/bash/bash-${pkgver}.tar.gz")

before_build() {
	go_src_dir
	echo ""
	PATCHLEVEL=`( cd $filedir/patches ; /bin/ls *.xz | tail -1 | cut -f 2 -d - | cut -f 1 -d . 2> /dev/null )`
	if [ "$PATCHLEVEL" = "" ]; then
		PATCHLEVEL=0
	fi
	pkgver=$pkgver.$PATCHLEVEL
	echo "PATCHLEVEL is $PATCHLEVEL"
	for i in `ls $filedir/patches/*.xz` ; do
		echo "Applying $i"
		xzcat $i | patch -p0 --verbose || exit 1
	done

}

BUILD_SYSTEM='autotools'
BUILD_KEYS="--prefix=/usr --build=$ARCH-slackware-linux"
INSTALL_KEYS="DESTDIR=$pkgdir"
after_build() {
	mkdir -p $pkgdir/bin
	mv $pkgdir/usr/bin/bash $pkgdir/bin/bash4.new
	strip --strip-unneeded $pkgdir/bin/bash4.new
	# We don't include the "bashbug" script.
	rm -rf $pkgdir/usr/bin $pkgdir/usr/man/man1/bashbug.1*
	mkdir -p $pkgdir/usr/doc/bash-$pkgver
	cp -a AUTHORS CHANGES COMPAT COPYING INSTALL MANIFEST NEWS NOTES \
	README Y2K doc/FAQ doc/INTRO $pkgdir/usr/doc/bash-$pkgver
	cd doc
	groff -ms -Tascii article.ms > $pkgdir/usr/doc/bash-$pkgver/article.txt
	rm -f $pkgdir/usr/info/dir

	( cd ${pkgdir}/bin ; ln -s bash sh.new )
	mkdir -p ${pkgdir}/usr/bin
	# I don't know why it ever needs, but let it be for now.
	( cd ${pkgdir}/usr/bin ; ln -s /bin/bash bash )

}

