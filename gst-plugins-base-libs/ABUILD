# ABUILD generated by mkpkg_generator.sh

pkgname=gst-plugins-base
pkgver=1.4.4
pkgbuild=1
arch=('auto')

shortdesc=('GStreamer Multimedia Framework Base Plugins')

tags=('libs media-libs')

source=("http://gstreamer.freedesktop.org/src/${pkgname}/${pkgname}-${pkgver}.tar.xz")

build_deps="make gcc gcc-g++ pkg-config gettext gstreamer orc libXv alsa-lib cdparanoia libvisual libvorbis libtheora pango gobject-introspection grep sed"

adddep="gst-plugins-base-libs"

pkglist="libs"

libs() {
  pkgname=gst-plugins-base-libs
  shortdesc=('GStreamer Multimedia Framework Base Plugin libraries')
  adddep=""
}

build() {
  go_src_dir
 ./configure --prefix=/usr \
             --sysconfdir=/etc \
             --localstatedir=/var \
             --libdir=/usr/lib${LIBDIRSUFFIX} \
             --disable-static \
             --enable-experimental \
             --disable-gnome_vfs \
             --with-package-name='GStreamer Base Plugins (AgiliaLinux)' \
             --with-package-origin='http://www.agilialinux.ru/'

  # https://bugzilla.gnome.org/show_bug.cgi?id=655517
  sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool
  make
  sed -e 's/^SUBDIRS_EXT =.*/SUBDIRS_EXT =/' -i Makefile
  make -C gst-libs DESTDIR="${pkgdir}" install
  make -C ext DESTDIR="${pkgdir}" install
  make -C gst-libs DESTDIR="${pkgdir}" uninstall
}

after_build() {
  rm -fr "${pkgdir}"/usr/share
  rm -fr "${pkgdir}"/usr/include
  rm -fr "${pkgdir}"/usr/lib${LIBDIRSUFFIX}/girepository-1.0
}

libs_prep(){
  go_src_dir
  make DESTDIR="${pkgdir}" install
}