pkgname=gksu
pkgver=2.0.2
pkgbuild=10
arch=('auto')

shortdesc="GTK graphical su front-end"

source=("http://people.debian.org/~kov/gksu/${pkgname}-${pkgver}.tar.gz")

tags="x11-libs libs"

pkglist="nautilus"

# Automatically-generated build_deps. Subject to revision.
build_deps="bzip2 gcc-libs glibc-solibs expat libffi libpng zlib libgpg-error ORBit2 libgcrypt libgnome-keyring glib2 atk cairo libgtop pango gdk-pixbuf gtk+2 GConf xcb-util startup-notification libgksu libXrender libX11 libxcb pixman libXdmcp libXau fontconfig freetype dbus"
nautilus() {
	pkgname=gksu-gnome
	shortdesc="GNOME extension from GKSU"
	longdesc="GKSu is a simple program-frontend for su/sudo. This package contains Nautilus extension for gksu"
	tags="gnome gnome-extra"
	adddep="gksu==$pkgver"
}

build() {
	go_src_dir
	burn_patches
	sed -i -e 's|/usr/bin/x-terminal-emulator|-l gnome-terminal|g' gksu.desktop || exit 1
	echo "TryExec=gnome-terminal" >> gksu.desktop
	libtoolize --force || exit 1
	aclocal || exit 1
	autoconf || exit 1
	automake || exit 1
	#SLKCFLAGS="$SLKCFLAGS -DHAVE_GNOME"
	CFLAGS="$SLKCFLAGS" ./configure --prefix=/usr --sysconfdir=/etc --libdir=/usr/lib${LIBDIRSUFFIX} \
	--localstatedir=/var --disable-static --libexecdir=/usr/lib$LIBDIRSUFFIX/libgksu \
	--enable-nautilus-extension || exit 1
	make -j${numjobs} || exit 1
	make DESTDIR="${pkgdir}" install || exit 1

      	# Locale
      	for i in po/*.po ; do
		L_FILE=`echo $i | sed -e 's/\.po$//g'`
		msgfmt -o $L_FILE.gmo $L_FILE.po
		mkdir -p ${pkgdir}/usr/share/locale/`basename $L_FILE`/LC_MESSAGES || exit 1
		cp -v $L_FILE.gmo ${pkgdir}/usr/share/locale/`basename $L_FILE`/LC_MESSAGES/gksu.mo || exit 1
	done
}

nautilus_prep() {
	mkdir -p ${pkgdir}/usr/lib${LIBDIRSUFFIX}
	mkdir -p ${pkgdir}/usr/share/applications
	mv -f $p_pkgdir/usr/lib${LIBDIRSUFFIX}/nautilus \
		$pkgdir/usr/lib${LIBDIRSUFFIX}
	mv -f $p_pkgdir/usr/share/applications/gksu.desktop \
		$pkgdir/usr/share/applications/



}
                  
